树形DP。对于环使用单调队列优化。